extends index2

block content
	script(src='https://code.jquery.com/jquery-3.5.0.min.js')
	- var message = msg;
	br
	#labelgcenter #{message}
	script.
		document.addEventListener('play', function(e){
		var audios = document.getElementsByTagName('audio');
		for(var i = 0, len = audios.length; i < len;i++){
		if(audios[i] != e.target){
		audios[i].pause();
		}
		}
		}, true);
	.artisth1
		h1 #{artist_name}
	.middlecontain
		.artistpage
			img(src=`../Images/Logos/${artist_name}.jpg`, alt="ADD ARTIST IMG HERE", height='275', width='275')
		.searchcontainart
			.searchformart
				form#searchy(method='POST')
					div
						label(for='search_results')       Search
						input#search_results(type='text', name='search_results' placeholder="Search for a Tune...")
					div
						input#a_name(type='hidden', name='a_name', value=`${artist_name}`)
					div
						a(href=`../../artist/${artist_name}`) Reload Back To All Tunes
			#test
				img(border='0', alt='back', src='../../Images/PageIMG/forward.png', height='45')
	.artistinfo
		h3 #{info}
	#labelgcenter2 #{message}
	- var x = tracks;
	- var userid = currentuserid;
	- var test = `${artist_name}`;

	#ulcontain
		each track in x
			.uldiv
				ul
					li.tunetext= `${track.track_name}`
					.regaudio
						audio(src=track.drive_url, type='audio/mpeg', controls='')
					.downloadbutton
						a(href=track.drive_url)
							img(border='0', alt='Download Tune', src='../Images/PageIMG/download.png', height='50')
						form(method='POST' action=`/artist/${artist_name}`)
							input#track_id.form-control(type='hidden', name='track_id', value=`${track.id}`)
							
							input#favetrack_name.form-control(type='hidden', name='favetrack_name', value=`${track.track_name}`)
							
							input#user_id.form-control(type='hidden', name='user_id', value=`${userid}`)
							
							input#name.form-control(type='hidden', name='name', value=`${artist_name}`)
							
							input(type='submit', value='Add to Favorites')
					
	#ulcontain2
	script.
		$(document).ready(function() {
		var theform = $('#searchy');
		var thebutton = $('#test');
		thebutton.click(function (ev) {
		ev.preventDefault();
		$.ajax({
		url:'/tunesearch',
		type: 'POST',
		data: theform.serialize(),
		success: function(data){

		console.log("MSG is: " + data.msg);
		console.log("Reloadlist is: " + data.reloadlist);
		console.log("Current USER ID is: " + data.currentuserid);
		console.log("Artist Name is: " + data.artist_name);
		console.table(data.tracks);
		var themsg = data.msg;
		document.getElementById('labelgcenter').innerHTML = themsg;
		document.getElementById('labelgcenter2').innerHTML = themsg;
		var reloadlist = data.reloadlist;
		if (reloadlist == 1){

			console.log("Replace elements!!!");
			var oldlist = document.getElementsByClassName("uldiv");
			const len = oldlist.length;
			for (var i = 0; i < len; i++){
				var element = oldlist[(oldlist.length - 1)].parentNode;
				element.removeChild(oldlist[(oldlist.length - 1)]);
			}
			var tracks = data.tracks;
			for (var i = 0; i < tracks.length; i++){
				console.log(tracks[i].track_name);
				console.log(tracks[i].drive_url);
				console.log(tracks[i].artist_name);
				var thecontainer = document.getElementById('ulcontain2');

				var newdiv = document.createElement('div');
				newdiv.setAttribute('class', 'uldiv');

				var newul = document.createElement('ul');

				var textli = document.createElement('li');
				textli.innerHTML = tracks[i].track_name;

				var audiodiv = document.createElement('div');
				audiodiv.setAttribute('class', 'regaudio');

				var newaudio = document.createElement('audio');
				newaudio.setAttribute('src', `${tracks[i].drive_url}`);
				newaudio.setAttribute('type', 'audio/mpeg');

				var downloaddiv = document.createElement('div');
				downloaddiv.setAttribute('class', 'downloadbutton');

				var downlink = document.createElement('a');
				downlink.setAttribute('href', `${tracks[i].drive_url}`);

				var downimage = document.createElement('img');
				downimage.setAttribute('border', '0');
				downimage.setAttribute('alt', 'Download Tune');
				downimage.setAttribute('src', '../Images/PageIMG/download.png');
				downimage.setAttribute('height', '50');

				var zeform = document.createElement('form');
				zeform.setAttribute('method', 'POST');
				zeform.setAttribute('action', `/artist/${artist_name}`);

				var trackidinput = document.createElement('input');
				trackidinput.setAttribute('id', 'track_id');
				trackidinput.setAttribute('class', 'form-control');
				trackidinput.setAttribute('type', 'hidden');
				trackidinput.setAttribute('name', 'track_id');
				trackidinput.setAttribute('value', `${tracks[i].id}`);

				var tracknameinput = document.createElement('input');
				tracknameinput.setAttribute('id', 'favetrack_name');
				tracknameinput.setAttribute('class', 'form-control');
				tracknameinput.setAttribute('type', 'hidden');
				tracknameinput.setAttribute('name', 'favetrack_name');
				tracknameinput.setAttribute('value', `${tracks[i].track_name}`);

				var useridinput = document.createElement('input');
				useridinput.setAttribute('id', 'user_id');
				useridinput.setAttribute('class', 'form-control');
				useridinput.setAttribute('type', 'hidden');
				useridinput.setAttribute('name', 'user_id');
				useridinput.setAttribute('value', `${data.currentuserid}`);

				var artistnameinput = document.createElement('input');
				artistnameinput.setAttribute('id', 'name');
				artistnameinput.setAttribute('class', 'form-control');
				artistnameinput.setAttribute('type', 'hidden');
				artistnameinput.setAttribute('name', 'name');
				artistnameinput.setAttribute('value', `${tracks[i].artist_name}`);

				var submitinput = document.createElement('input');
				submitinput.setAttribute('type', 'submit');
				submitinput.setAttribute('value', `Add to Favorites`);

				zeform.appendChild(trackidinput);
				zeform.appendChild(tracknameinput);
				zeform.appendChild(useridinput);
				zeform.appendChild(artistnameinput);
				zeform.appendChild(submitinput);

				downlink.appendChild(downimage);

				downloaddiv.appendChild(downlink);
				downloaddiv.appendChild(zeform);

				audiodiv.appendChild(newaudio);

				newul.appendChild(textli);
				newul.appendChild(audiodiv);
				newul.appendChild(downloaddiv);

				newdiv.appendChild(newul);

				thecontainer.appendChild(newdiv);

			}

		}

		},
		error: function(){
		console.log("Didn't Work");
		}
		});//ajax
		});//submit
		});