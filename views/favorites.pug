extends index3

block content
	script(src='https://code.jquery.com/jquery-3.5.0.min.js')
	- var usename = username;
	.welcometxt
		h1 Welcome #{usename}! Here are your favorite CHUNES:
	- var y = thetracks;
	- var userid = currentuserid;
	- var message = msg;
	script.
		document.addEventListener('play', function(e){
		var audios = document.getElementsByTagName('audio');
		for(var i = 0, len = audios.length; i < len;i++){
		if(audios[i] != e.target){
		audios[i].pause();
		}
		}
		}, true);
	.middlecontain
		.searchcontainart
				.searchformart
					form#searchy(method='POST')
						div
							label.boldtext(for='search_results') Tune Search
							input#search_results(type='text', name='search_results' placeholder="Type Search here...")
						div
							label.boldtext(for='search_style') Search by Track
							input#search_style.form-control(type='radio', name='search_style', checked="checked", value=0)
						div
							label.boldtext(for='search_style') Search by Artist
							input#search_style.form-control(type='radio', name='search_style', value=1)
						#test
							img(border='0', alt='back', src='../Images/PageIMG/tunesearch.png', height='45')
						div
							a(href=`../favorites`) Reload Back To All Tunes
	#labelgcenter #{message}
	#ulcontain
		each track, index in y
			.uldiv
				ul
					li.tunetexttotw= `${track.artist_name} - ${track.track_name}`
					.regaudio
						audio(src=track.drive_url, type='audio/mpeg', controls='')
					li.tunetext= `       `
					.downloadbutton
						a(href=track.drive_url)
							img(border='0', alt='Download Tune', src='../Images/PageIMG/download2.png', height='50')
						form(id=`form ${index}`, method='POST' action=`/favorites`)
							div.form-group
								input#track_id.form-control(type='hidden', name='track_id', value=`${track.id}`)
							div.form-group
								input#favetrack_name.form-control(type='hidden', name='favetrack_name', value=`${track.track_name}`)
							div.form-group
								input#user_id.form-control(type='hidden', name='user_id', value=`${userid}`)
							div.form-group
								input#name.form-control(type='hidden', name='name', value=`${track.artist_name}`)
							div
								input(type='submit', value='Remove From Favorites')
					li.tunetext= `  ­   ­   ­   ­   ­   ­   ­   ­   ­   ­   ­   ­   ­   ­   ­   ­ `
					a(href="")
	#ulcontain2
	script.
		$(document).ready(function() {
		var theform = $('#searchy');
		var thebutton = $('#test');
		thebutton.click(function (ev) {
		ev.preventDefault();
		$.ajax({
		url:'/favtunesearch',
		type: 'POST',
		data: theform.serialize(),
		success: function(data){

			var themsg = data.msg;
			document.getElementById('labelgcenter').innerHTML = themsg;
			var reloadlist = data.reloadlist;

			if (reloadlist == 1){
				console.log("reload list!")
				var oldlist = document.getElementsByClassName("uldiv");
				const len = oldlist.length;
				for (var i = 0; i < len; i++){
					var element = oldlist[(oldlist.length - 1)].parentNode;
					element.removeChild(oldlist[(oldlist.length - 1)]);
				}
				var tracks = data.tracks;
				for (var i = 0; i < tracks.length; i++){
					//set container, everything will added within
					var thecontainer = document.getElementById('ulcontain2');

					var newdiv = document.createElement('div');
					newdiv.setAttribute('class', 'uldiv');

					var newul = document.createElement('ul');

					//Track Name Line
					var textli = document.createElement('li');
					textli.setAttribute('class', 'tunetexttotw');
					textli.innerHTML = `${tracks[i].artist_name} - ${tracks[i].track_name}`;

					//audio div
					var audiodiv = document.createElement('div');
					audiodiv.setAttribute('class', 'regaudio');

					//audio element
					var newaudio = document.createElement('audio');
					newaudio.setAttribute('src', `${tracks[i].drive_url}`);
					newaudio.setAttribute('type', 'audio/mpeg');
					newaudio.setAttribute('controls', '');

					//download div
					var downloaddiv = document.createElement('div');
					downloaddiv.setAttribute('class', 'downloadbutton');

					//download link
					var downlink = document.createElement('a');
					downlink.setAttribute('href', `${tracks[i].drive_url}`);

					//download image
					var downimage = document.createElement('img');
					downimage.setAttribute('border', '0');
					downimage.setAttribute('alt', 'Download Tune');
					downimage.setAttribute('src', '../Images/PageIMG/download.png');
					downimage.setAttribute('height', '50');

					//form
					var zeform = document.createElement('form');
					zeform.setAttribute('method', 'POST');
					zeform.setAttribute('action', `/favorites`);

					//form inputs:
					var trackidinput = document.createElement('input');
					trackidinput.setAttribute('id', 'track_id');
					trackidinput.setAttribute('class', 'form-control');
					trackidinput.setAttribute('type', 'hidden');
					trackidinput.setAttribute('name', 'track_id');
					trackidinput.setAttribute('value', `${tracks[i].id}`);

					var tracknameinput = document.createElement('input');
					tracknameinput.setAttribute('id', 'favetrack_name');
					tracknameinput.setAttribute('class', 'form-control');
					tracknameinput.setAttribute('type', 'hidden');
					tracknameinput.setAttribute('name', 'favetrack_name');
					tracknameinput.setAttribute('value', `${tracks[i].track_name}`);

					var useridinput = document.createElement('input');
					useridinput.setAttribute('id', 'user_id');
					useridinput.setAttribute('class', 'form-control');
					useridinput.setAttribute('type', 'hidden');
					useridinput.setAttribute('name', 'user_id');
					useridinput.setAttribute('value', `${data.currentuserid}`);

					var artistnameinput = document.createElement('input');
					artistnameinput.setAttribute('id', 'name');
					artistnameinput.setAttribute('class', 'form-control');
					artistnameinput.setAttribute('type', 'hidden');
					artistnameinput.setAttribute('name', 'name');
					artistnameinput.setAttribute('value', `${tracks[i].artist_name}`);

					var submitinput = document.createElement('input');
					submitinput.setAttribute('type', 'submit');
					submitinput.setAttribute('value', `Remove From Favorites`);

					//finishing form
					zeform.appendChild(trackidinput);
					zeform.appendChild(tracknameinput);
					zeform.appendChild(useridinput);
					zeform.appendChild(artistnameinput);
					zeform.appendChild(submitinput);

					//finishing download
					downlink.appendChild(downimage);
					downloaddiv.appendChild(downlink);
					downloaddiv.appendChild(zeform);

					//finishing audio
					audiodiv.appendChild(newaudio);

					//final appends
					newul.appendChild(textli);
					newul.appendChild(audiodiv);
					newul.appendChild(downloaddiv);
					newdiv.appendChild(newul);

					//insert into page
					thecontainer.appendChild(newdiv);


				}//end for loop


			}//end if, reloading page elements within

		},
		error: function(){
		console.log("Didn't Work");
		}
		});//ajax
		});//submit
		});