extends index

block content
	script(src='https://code.jquery.com/jquery-3.5.0.min.js')
	txt  
	.artisth1 
		h1 S3 Test Upload
	#labelgcenter

	div(title=`${theid}`, id='dashartid')
	div(title=`${theartname}`, id='dashartname')
	div(title='0', id='currentcollabvalue')
	div(title='0', id='currentremixvalue')
	div(title='0', id='collabcounter')
	div(title='0', id='collabminus')
	div(title='0', id='remixcounter')

	br


	.faqform
		form#fileuploadform(method='POST', enctype='multipart/form-data')
			.downloadbutton
				.labelmid Track Name:
			input#tra_name(type='text', name='tra_name' style="padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.5em; padding-left: 1em; padding-right: 1em; min-width: 100%;")
			br
			.middlecontain
				.label2 Is Collab?:
					.labelflexdiv
						.labelflex Yes
							input#is_collab.is_collab(type='radio', name='is_collab', value=1, style="height:35px; width:35px; vertical-align: middle;", onclick="change(this.value)")
						.labelflex No
							input#is_collab.is_collab(type='radio', name='is_collab', checked="checked", value=0, style="height:35px; width:35px; vertical-align: middle;", onclick="change(this.value)")
				.label2 Is Remix?:
					.labelflexdiv
						.labelflex Yes
							input#is_remix.is_remix(type='radio', name='is_remix', value=1, style="height:35px; width:35px; vertical-align: middle;", onclick="changeRemix(this.value)")
						.labelflex No
							input#is_remix.is_remix(type='radio', name='is_remix', checked="checked", value=0, style="height:35px; width:35px; vertical-align: middle;", onclick="changeRemix(this.value)")
	
			#collabfields
				#collabfield1
					.downloadbutton
						.labelmid Collab Artist 1:
					.middlecontain
						input#col1(type='text', name='col1', value="", style="padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.5em; padding-left: 1em; padding-right: 1em; min-width: 70%;")
						img(id='addcol', class='addcolbtn', border='2', alt='back', src='Images/PageIMG/upload.png', height='35')

				#collabfield2
					.downloadbutton
						.labelmid Collab Artist 2:
					input#col2(type='text', name='col2', value="", style="padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.5em; padding-left: 1em; padding-right: 1em; min-width: 100%;")

				#collabfield3
					.downloadbutton
						.labelmid Collab Artist 3:
					input#col3(type='text', name='col3', value="", style="padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.5em; padding-left: 1em; padding-right: 1em; min-width: 100%;")

				#collabfield4
					.downloadbutton
						.labelmid Collab Artist 4:
					input#col4(type='text', name='col4', value="", style="padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.5em; padding-left: 1em; padding-right: 1em; min-width: 100%;")

			br

			#remixfields
				#remixfield1
					.downloadbutton
						.labelmid Original Artist 1:
					.middlecontain
						input#rem1(type='text', name='rem1', value="", style="padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.5em; padding-left: 1em; padding-right: 1em; min-width: 70%;")
						img(id='addrem/1', class='addrembtn', border='2', alt='back', src='Images/PageIMG/upload.png', height='35')
				#remixfield2
					.downloadbutton
						.labelmid Original Artist 2:
					input#rem2(type='text', name='rem2', value="", style="padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.5em; padding-left: 1em; padding-right: 1em; min-width: 100%;")

			.label3 Upload File:
			br
			div.form-group
				input#thefile(type='file', name='thefile', style="min-width: 100%; border: solid 2px; padding: 1em; margin-bottom: 0.75em;")
			.downloadbutton
				div(id='thesubmit', class='thesubmit')
					img(border='2', alt='back', src='Images/PageIMG/upload.png', height='50')
			.downloadbutton
				#labelgcenter2
	.downloadbutton
		#ulcontain
			.uldiv
				ul
					.regaudio
						audio(id='0/5/A3/420', src='https://riddim-archive-tune-store.s3-us-west-1.amazonaws.com/A/A3/420.mp3', type='audio/mpeg', controls='', preload='none')
						
	script.
		$(document).on("keydown", "form", function(event) { 
			return event.key != "Enter";
		});

		$(document).bind("keydown keypress", function(e){
			if( e.which == 8 ){ // 8 == backspace
				if(e.target.readOnly ){
					e.preventDefault();
				}
			}
		});

		$(document).ready(function() {
			console.log("Doc ready");
			document.getElementById("currentcollabvalue").title = 0;
			document.getElementById("currentremixvalue").title = 0;
			uploadInit();
			collabInit();
			remixInit();
		});

		function change(thevalue){
			var collabfields = document.getElementById("collabfields");
			if(thevalue == 1){
				console.log("1");
				collabfields.style.display = "block";
			}
			if(thevalue == 0){
				console.log("0");
				collabfields.style.display = "none";
			}

			document.getElementById("currentcollabvalue").title = thevalue;
			var elements = document.getElementsByClassName('is_collab');
			var top = elements[0];
			var bottom = elements[1];
			top.value = 1;
			bottom.value = 0;
		}

		function changeRemix(thevalue){
			var remixfields = document.getElementById("remixfields");
			if(thevalue == 1){
				console.log("1");
				remixfields.style.display = "block";
			}
			if(thevalue == 0){
				console.log("0");
				remixfields.style.display = "none";
			}
			document.getElementById("currentremixvalue").title = thevalue;
			var elements = document.getElementsByClassName('is_remix');
			var top = elements[0];
			var bottom = elements[1];
			top.value = 1;
			bottom.value = 0;
		}

		function getCurrentCollabValue(){
			return document.getElementById("currentcollabvalue").title;
		}

		function getCurrentRemixValue(){
			return document.getElementById("currentremixvalue").title;
		}

		function collabInit(){
			document.querySelectorAll('.addcolbtn').forEach(item => {
				item.addEventListener('click', event => {
				var counterstr = document.getElementById("collabcounter").title.toString();
				var counter = parseInt(counterstr);
				var minusstr = document.getElementById("collabminus").title.toString();
				var minusmode = parseInt(minusstr);

				switch(counter) {
					case 0:
						var field2 = document.getElementById("collabfield2");
						if(minusmode == 0){
							field2.style.display = "block";
							counter++;
							document.getElementById("collabcounter").title = counter;
						}else{
							field2.style.display = "none";
							document.getElementById("collabminus").title = 0;
							item.src = 'Images/PageIMG/upload.png';
						}
						break;
					case 1:
						var field3 = document.getElementById("collabfield3");
						if(minusmode == 0){
							field3.style.display = "block";
							counter++;
							document.getElementById("collabcounter").title = counter;
						}else{
							field3.style.display = "none";
							counter--;
							document.getElementById("collabcounter").title = counter;
							minusmode = 0;
						}
						break;
					case 2:
						var field4 = document.getElementById("collabfield4");
						if(minusmode == 0){
							field4.style.display = "block";
						}else{
							field4.style.display = "none";
							counter--;
							document.getElementById("collabcounter").title = counter;
						}
						document.getElementById("collabminus").title = 1;

						item.src = 'Images/PageIMG/minus.png';
						break;
				}//end switch

				});//click event
			});//class selector
		}

		function remixInit(){
			document.querySelectorAll('.addrembtn').forEach(item => {
				item.addEventListener('click', event => {
					var remixstr = document.getElementById("remixcounter").title.toString();
					var counter = parseInt(remixstr);
					if(counter == 0){
						var field2 = document.getElementById("remixfield2");
						field2.style.display = "block";
						counter++;
						document.getElementById("remixcounter").title = counter;
						item.src = 'Images/PageIMG/minus.png';
					}else{
						var field2 = document.getElementById("remixfield2");
						field2.style.display = "none";
						counter--;
						document.getElementById("remixcounter").title = counter;
						item.src = 'Images/PageIMG/upload.png';
					}
				});//click event
			});//class selector
		}

		function uploadInit(){
			var theform = $('#fileuploadform');
			var thebutton = $('#thesubmit');
			thebutton.click(function (ev) {
				console.log("clicked button");
				ev.preventDefault();
				var msg = document.getElementById("labelgcenter");
				msg.innerHTML = "Uploading...";
				var msg2 = document.getElementById("labelgcenter2");
				msg2.innerHTML = "Uploading...";
				var fd = new FormData();
				var files = $('#thefile')[0].files[0];

				var artist_name = document.getElementById("dashartname").title;
				var artist_id = document.getElementById("dashartid").title;

				var track_name = document.getElementById("tra_name").value.toString();

				var is_collab = getCurrentCollabValue();
				var is_remix = getCurrentRemixValue();

				var col1 = document.getElementById("col1").value;
				var col2 = document.getElementById("col2").value;
				var col3 = document.getElementById("col3").value;
				var col4 = document.getElementById("col4").value;

				var rem1 = document.getElementById("rem1").value;
				var rem2 = document.getElementById("rem2").value;

				fd.append('file', files);
				fd.append('artist_name', artist_name);
				fd.append('artist_id', artist_id);
				fd.append('track_name', track_name);
				fd.append('is_collab', is_collab);
				fd.append('is_remix', is_remix);

				fd.append('col1', col1);
				fd.append('col2', col2);
				fd.append('col3', col3);
				fd.append('col4', col4);
				fd.append('rem1', rem1);
				fd.append('rem2', rem2);

				$.ajax({
					url:'/tests3upload',
					type: 'POST',
					data: fd,
					processData: false,
					contentType: false,
					success: function(data){
						var msg = document.getElementById("labelgcenter");
						var msg2 = document.getElementById("labelgcenter2");
						msg.innerHTML = data.msg;
						msg2.innerHTML = data.msg;
					},
					error: function(){
						console.log("Didn't Work");
					}
				});
			});
		}